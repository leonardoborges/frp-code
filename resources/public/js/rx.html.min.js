/**
* Copyright 2013 Microsoft Corporation
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

(function(d,k){var g="object"==typeof exports&&exports&&("object"==typeof d&&d&&d==d.global&&(window=d),exports);"function"===typeof define&&define.amd?define(["./rx","exports"],function(g,f){d.Rx=k(d,f,g);return d.Rx}):"object"==typeof module&&module&&module.exports==g?(g=k(d,module.exports,require("./rx")),module.exports=g.Rx):d.Rx=k(d,{},d.Rx)})(this,function(d,k){function g(a,c,b){if(a.addEventListener)return a.addEventListener(c,b,!1),l(function(){a.removeEventListener(c,b,!1)});if(a.attachEvent)return a.attachEvent("on"+
c,b),l(function(){a.detachEvent("on"+c,b)});a["on"+c]=b;return l(function(){a["on"+c]=null})}function q(a,c,b){var e=new n;if(a&&a.nodeName||a===d)e.add(g(a,c,b));else if(a&&a.length)for(var j=0,f=a.length;j<f;j++)e.add(q(a[j],c,b));return e}"object"==typeof exports&&exports&&"object"==typeof d&&d&&d==d.global&&(window=d);var f=d.Rx,h=f.Observable,p=h.createWithDisposable,l=f.Disposable.create,n=f.CompositeDisposable,r=f.RefCountDisposable,s=f.AsyncSubject;h.fromEvent=function(a,c){return p(function(b){return q(a,
c,function(a){b.onNext(a)})})};var m,t=document.createElement("div");m=function(a){t.appendChild(a);t.innerHTML=""};var v=0;h.getJSONPRequest=function(a){var c=new s,b=document.getElementsByTagName("head")[0]||document.documentElement,e=document.createElement("script"),j="rxjscallback"+v++;a=a.replace("=JSONPCallback","="+j);d[j]=function(a){c.onNext(a);c.onCompleted()};e.src=a;e.async=!0;e.onload=e.onreadystatechange=function(a,c){if(c||!e.readyState||/loaded|complete/.test(e.readyState))e.onload=
e.onreadystatechange=null,b&&e.parentNode&&m(e),e=k,delete d[j]};b.insertBefore(e,b.firstChild);var f=new r(l(function(){/loaded|complete/.test(e.readyState)||(e.abort(),e.onload=e.onreadystatechange=null,b&&e.parentNode&&m(e),e=k,delete d[j],c.onError(Error("The script has been aborted")))}));return p(function(a){return new n(c.subscribe(a),f.getDisposable())})};var u=h.ajax=function(a){"string"===typeof a&&(a={method:"GET",url:a,async:!0});a.async===k&&(a.async=!0);var c=new s,b;if(d.XMLHttpRequest)b=
new d.XMLHttpRequest;else try{b=new d.ActiveXObject("Microsoft.XMLHTTP")}catch(e){throw Error("XMLHttpRequest is not supported by your browser");}try{a.user?b.open(a.method,a.url,a.async,a.user,a.password):b.open(a.method,a.url,a.async);if(a.headers){var f=a.headers,g;for(g in f)b.setRequestHeader(g,f[g])}b.onreadystatechange=b.onload=function(){if(4===b.readyState){var a=b.status;if(200<=a&&300>=a||0===a||""===a)c.onNext(b),c.onCompleted();else c.onError(b)}};b.onerror=b.onabort=function(){c.onError(b)};
b.send(a.body||null)}catch(h){c.onError(h)}var m=new r(l(function(){4!==b.readyState&&(b.abort(),c.onError(b))}));return p(function(a){return new n(c.subscribe(a),m.getDisposable())})};h.post=function(a,c){return u({url:a,body:c,method:"POST",async:!0})};var w=h.get=function(a){return u({url:a,method:"GET",async:!0})};JSON&&JSON.parse&&(h.getJSON=function(a){return w(a).select(function(a){return JSON.parse(a.responseText)})});return f});